# Typo3

## Concepts

- **extensions**:
  - `plugin`: content elements placed as elements on pages
  - `modules`: custom entries in backend-menu
  - `site-package`: ~= theme
  - `distribution`: site-package + content
- **TCA**:
  - table configuration array
  - `$GLOBALS['TCA']`
  - a central configuration in TYPO3 that defines how database tables and their fields are presented and managed in the TYPO3 backend
    - `columns`: lists db tables
    - `types`: definitions of backend forms, determines which fields are shown for different content types or records and how they are grouped and ordered
    - `palettes`: groups of fields displayed together
- **typoscript**:
  - just a php array
  - many numbered fields
  - backend: Tsconfig
    - for setting variables
      - `page.config.contentObjectExceptionHandler = 0`
  - frontend: typoscript:
    - for styling
      - fluid-template: typoscript is no longer used for styling ... thank god. Instead, in typoscript you now refer typo3 to use `templateRootPath`, `partialRootPath`, `layoutRootPath` to look for fluid-templates, which is a standard templating engine like handlebars
        - `layout`: defines a full page
        - `template`: styling of a specific content-element
        - `partial`: reusable small parts of layouts or templates
  -

## Installation

Currently, version 11 hits a sweet spot:

- mask works
- mask exporter works
- extension builder works
- beginner example theme works
  Versions before and after that miss one or more of those.

```docker-compose.yml

version: '3'

services:
  typo3:
    build: .
    ports:
      - '80:80'
    volumes:
      - ./typo3conf:/var/www/html/typo3conf  # contains user-config and site-packages
      - fileadmin:/var/www/html/fileadmin
      - uploads:/var/www/html/uploads
    networks:
      - backend

  database:
    image: mysql:8.0
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
    environment:
      - 'MYSQL_USER=admin'
      - 'MYSQL_PASSWORD=password'
      - 'MYSQL_DATABASE=typo3'
      - 'MYSQL_ROOT_PASSWORD=password'
    networks:
      - backend

volumes:
  database:
  fileadmin:
  uploads:
networks:
  backend:

```

```Dockerfile
# Docker image for TYPO3 CMS
# Copyright (C) 2016-2023  Martin Helmich <martin@helmich.me>
#                          and contributors <https://github.com/martin-helmich/docker-typo3/graphs/contributors>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

# NOTE: This file is automatically generated from a template. Please
# do not make any changes to this file directly, and consult the
# CONTRIBUTING document, first.

FROM php:8.2-apache-bookworm
LABEL maintainer="Martin Helmich <typo3@martin-helmich.de>"

# Install TYPO3
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y --no-install-recommends \
        wget \
# Configure PHP
        libxml2-dev libfreetype6-dev \
        libjpeg62-turbo-dev \
        libmcrypt-dev \
        libpng-dev \
        libpq-dev \
        libzip-dev \
        zlib1g-dev \
# Install required 3rd party tools
        graphicsmagick && \
# Configure extensions
    docker-php-ext-configure gd --with-libdir=/usr/include/ --with-jpeg --with-freetype && \
    docker-php-ext-install -j$(nproc) mysqli soap gd zip opcache intl pgsql pdo_pgsql && \
    echo 'always_populate_raw_post_data = -1\nmax_execution_time = 240\nmax_input_vars = 1500\nupload_max_filesize = 32M\npost_max_size = 32M' > /usr/local/etc/php/conf.d/typo3.ini && \
# Configure Apache as needed
    a2enmod rewrite && \
    apt-get clean && \
    apt-get -y purge \
        libxml2-dev libfreetype6-dev \
        libjpeg62-turbo-dev \
        libmcrypt-dev \
        libpng-dev \
        libzip-dev \
        zlib1g-dev && \
    rm -rf /var/lib/apt/lists/* /usr/src/*

RUN cd /var/www/html && \
    wget -O download.tar.gz https://get.typo3.org/11.5.36 && \
    echo "c67f8ef8ff9c2d0a42d4e072a85181db40d9d27a0daf0f00a4c689aa5bd6a620 download.tar.gz" > download.tar.gz.sum && \
    sha256sum -c download.tar.gz.sum && \
    tar -xzf download.tar.gz && \
    rm download.* && \
    ln -s typo3_src-* typo3_src && \
    ln -s typo3_src/index.php && \
    ln -s typo3_src/typo3 && \
    cp typo3/sysext/install/Resources/Private/FolderStructureTemplateFiles/root-htaccess .htaccess && \
    mkdir typo3temp && \
    mkdir typo3conf && \
    mkdir fileadmin && \
    mkdir uploads && \
    touch FIRST_INSTALL && \
    chown -R www-data. . && \
    chmod -R 777 typo3conf

# Configure volumes
VOLUME /var/www/html/fileadmin
VOLUME /var/www/html/typo3conf
VOLUME /var/www/html/typo3temp
VOLUME /var/www/html/uploads
```

## Site-packages

1. https://www.sitepackagebuilder.com/
2. extensions/upload
3. Edit in vscode in `typo3conf/ext/<your-extension-name>`

Site packages are a type of plugin that contains template files for all kinds of pages in a typo3-site.
They are basically themes.
Is configured such that all other packages' styles will be overwritten.

## Extbase

This is for if you want to create custom tables, with custom CRUD operations, analog to rails-scaffold.
Very useful for creating **content elements**.

- Boilerplate built with extension-builder plugin.
  - Ironically, extension-builder does not yet exist for typo3 > v11
- Model, Controller: Extbase
- View: Fluid
- Editor-configuration: FlexForm
  - but not automatically part of a new extension created with extension-builder

https://www.youtube.com/watch?v=1ntrxveQRiE
https://www.youtube.com/watch?v=XO23s4AdXG4
https://www.youtube.com/watch?v=VN9_AwqpE2o

### Fluid-templates

- `ext/<your-ext-name>/Resources/Private/Layouts` and `ext/<your-ext-name>/Resources/Private/Templates`
- show all data: `<f:debug>{_all}</f:debug>`

## Custom content elements

- _Manually_:
  - Overview: https://b13.com/blog/how-to-create-custom-content-elements-in-typo3
    - custom fields by extending `tt_content` entry in TCA
    - custom content using known and new fields
    - preview
    - data-processor
    - frontend-rendering
  - Details:
    - custom fields: https://docs.typo3.org/m/typo3/reference-coreapi/10.4/en-us/ExtensionArchitecture/ExtendingTca/Index.html#extending
    - custom content: https://docs.typo3.org/m/typo3/reference-coreapi/10.4/en-us/ApiOverview/ContentElements/AddingYourOwnContentElements.html
    - Ãœbersicht: https://www.youtube.com/watch?v=eaQEf7EeD_I
- _Mask_
  - Mask als custom content builder: https://www.youtube.com/watch?v=fnJODmG9FXU
  - export: https://github.com/IchHabRecht/mask_export
  - probably requires that you include fluid_styled_content in your site-package
  - definitely requires that you include your packages static templates in your site-package

## Flexform

With your extbase-extension, you now have the backend logic to fetch data from a db, transform it, and direct it to a template.
But you still need to be able to allow an editor to say something like "at this place in this page, I want you to display the entity nr x using the `showSingleAction` method".
You _can_ create a custom-content type using dce or mask, but since you already have a module, you can just add a flexform to your module:

Configuration/FlexForms/flexform.xml

```xml
<T3DataStructure>
    <sheets>
        <sDEF>
            <ROOT>
                <TCEforms>
                    <sheetTitle>General</sheetTitle>
                </TCEforms>
                <el>
                    <settings.record>
                        <TCEforms>
                            <label>Select a Record</label>
                            <config>
                                <type>group</type>
                                <internal_type>db</internal_type>
                                <allowed>tx_yourextension_domain_model_yourmodel</allowed>
                                <size>1</size>
                                <maxitems>1</maxitems>
                                <minitems>0</minitems>
                            </config>
                        </TCEforms>
                    </settings.record>
                </el>
            </ROOT>
        </sDEF>
    </sheets>
</T3DataStructure>
```

https://www.youtube.com/watch?v=WticPjNRPTI&list=PL3rp1RjcIPQjWpTxdMyJJ48T6zqslH7Cm&index=6
